name: $SENSENCRYPT_POLICY_NAME
version: "0.3"

# Access control:
#   - only the data owner (CREATOR) can read or update the session
#   - even the data owner cannot read the session secrets (i.e., the volume key and tag)

access_policy:
  read:
   - CREATOR
  update:
   - CREATOR

# Service: copy_files
#   - copies files or data from a given input directory give by argument -i
#   - copies files or data  to an output directory (which is in this case an encrypted volume) given by argument
#   - /input is mapped into the container as an unencrypted volume / directory

services:
  - name: SensEncrypt
    image_name: sensencrypt_image
#    mrenclaves: ["$MRENCLAVE_SENSENCRYPT"]
    command: /copy_files  -i /encrypt-input -o /encrypt-output

images:
  - name: sensencrypt_image
    volumes:
      - name: encrypt_output_volume
        path: /encrypt-output
        update_policy: no_rollback_protection

security:
  attestation:
    mode: none

volumes:
  - name: encrypt_output_volume
    fspf_key: $SENSENCRYPT_FSPF_KEY
    export:
      - to:
          session: $ALGORITHM_POLICY_NAME
        update_policy: no_rollback_protection
